---
title: DSL Root Schema
description: Complete specification of the Constela program structure
---

## Overview

Every Constela program is a single JSON object that follows a specific schema. This document describes the top-level structure that all Constela programs must adhere to.

```json
{
  "version": "1.0",
  "state": { ... },
  "actions": [ ... ],
  "view": { ... },
  "components": { ... }
}
```

## Root Properties

<PropsTable items={[
  { name: "version", type: "string", required: true, description: "DSL version identifier. Currently only \"1.0\" is supported." },
  { name: "type", type: "\"layout\"", required: false, description: "File type identifier. Set to \"layout\" for layout files." },
  { name: "state", type: "Record<string, StateField>", required: true, description: "Application state definitions. Keys are state names, values are field definitions." },
  { name: "actions", type: "ActionDefinition[]", required: true, description: "Array of action definitions that describe how state changes." },
  { name: "view", type: "ViewNode", required: true, description: "The root view node that describes the UI structure." },
  { name: "components", type: "Record<string, ComponentDef>", required: false, description: "Reusable component definitions. Keys are component names." },
  { name: "connections", type: "Record<string, ConnectionDef>", required: false, description: "WebSocket connection definitions. Keys are connection names. See Connections reference." },
  { name: "imports", type: "Record<string, string>", required: false, description: "Static data imports. Keys are imported data names, values are relative paths to JSON files." },
  { name: "externalImports", type: "Record<string, string>", required: false, description: "External module imports from CDN. Keys are module names, values are CDN URLs." },
  { name: "lifecycle", type: "LifecycleHooks", required: false, description: "Lifecycle hook definitions for mount, unmount, and route events." },
  { name: "route", type: "RouteDefinition", required: false, description: "Route metadata including path, layout, and meta tags." }
]} />

## State Field Definition

Each state field specifies a type and initial value.

<PropsTable items={[
  { name: "type", type: "\"string\" | \"number\" | \"boolean\" | \"list\" | \"object\"", required: true, description: "The data type of the state field." },
  { name: "initial", type: "any", required: true, description: "The initial value. Must match the declared type." }
]} />

### Example State

```json
{
  "state": {
    "count": { "type": "number", "initial": 0 },
    "message": { "type": "string", "initial": "Hello" },
    "items": { "type": "list", "initial": [] },
    "user": { "type": "object", "initial": { "name": "", "age": 0 } },
    "isActive": { "type": "boolean", "initial": false }
  }
}
```

## Component Definition

Components allow you to create reusable UI pieces with optional local state.

<PropsTable items={[
  { name: "params", type: "Record<string, ParamDef>", required: false, description: "Component parameter definitions with types and optional defaults." },
  { name: "localState", type: "Record<string, StateField>", required: false, description: "Component-scoped state. Each instance maintains its own independent state." },
  { name: "localActions", type: "LocalActionDefinition[]", required: false, description: "Actions that operate on local state. Only set, update, and setPath steps are allowed." },
  { name: "view", type: "ViewNode", required: true, description: "The view tree for this component." }
]} />

### Param Definition

<PropsTable items={[
  { name: "type", type: "\"string\" | \"number\" | \"boolean\" | \"json\"", required: true, description: "The expected type of the parameter." },
  { name: "required", type: "boolean", required: false, default: "true", description: "Whether the parameter is required." }
]} />

### Example Component

```json
{
  "components": {
    "Button": {
      "params": {
        "label": { "type": "string" },
        "variant": { "type": "string" }
      },
      "view": {
        "kind": "element",
        "tag": "button",
        "props": {
          "class": { "expr": "param", "name": "variant" }
        },
        "children": [
          { "kind": "text", "value": { "expr": "param", "name": "label" } }
        ]
      }
    }
  }
}
```

### Example Component with Local State

```json
{
  "components": {
    "Accordion": {
      "params": { "title": { "type": "string" } },
      "localState": {
        "isExpanded": { "type": "boolean", "initial": false }
      },
      "localActions": [
        {
          "name": "toggle",
          "steps": [{ "do": "update", "target": "isExpanded", "operation": "toggle" }]
        }
      ],
      "view": {
        "kind": "element",
        "tag": "div",
        "children": [
          {
            "kind": "element",
            "tag": "button",
            "props": { "onClick": { "event": "click", "action": "toggle" } },
            "children": [
              { "kind": "text", "value": { "expr": "param", "name": "title" } }
            ]
          },
          {
            "kind": "if",
            "condition": { "expr": "state", "name": "isExpanded" },
            "then": { "kind": "slot" }
          }
        ]
      }
    }
  }
}
```

## Complete Example

```json
{
  "version": "1.0",
  "state": {
    "count": { "type": "number", "initial": 0 }
  },
  "actions": [
    {
      "name": "increment",
      "steps": [
        { "do": "update", "target": "count", "operation": "increment" }
      ]
    }
  ],
  "view": {
    "kind": "element",
    "tag": "div",
    "children": [
      {
        "kind": "text",
        "value": { "expr": "state", "name": "count" }
      },
      {
        "kind": "element",
        "tag": "button",
        "props": {
          "onClick": { "event": "click", "action": "increment" }
        },
        "children": [
          { "kind": "text", "value": { "expr": "lit", "value": "+1" } }
        ]
      }
    ]
  }
}
```

## Imports

The `imports` property allows you to load static JSON data files at build time.

```json
{
  "imports": {
    "config": "../data/config.json",
    "examples": "../data/examples.json"
  }
}
```

Access imported data using the `import` expression:

```json
{ "expr": "import", "name": "config", "path": "siteName" }
```

## External Imports

The `externalImports` property allows you to dynamically import external JavaScript modules from CDN at runtime.

```json
{
  "externalImports": {
    "monaco-editor": "https://cdn.jsdelivr.net/npm/monaco-editor@0.52.0/+esm",
    "chart.js": "https://cdn.jsdelivr.net/npm/chart.js@4.4.0/+esm"
  }
}
```

Use with the `import` action step to load modules dynamically:

```json
{
  "do": "import",
  "module": "monaco-editor",
  "result": "monaco",
  "onSuccess": [
    {
      "do": "call",
      "target": { "expr": "var", "name": "monaco", "path": "editor.create" },
      "args": [{ "expr": "ref", "name": "editorContainer" }]
    }
  ]
}
```

## Lifecycle Hooks

The `lifecycle` property defines actions to execute at specific points in the component or page lifecycle.

<PropsTable items={[
  { name: "onMount", type: "string", required: false, description: "Action name to execute when the component/page is mounted." },
  { name: "onUnmount", type: "string", required: false, description: "Action name to execute when the component/page is unmounted." },
  { name: "onRouteEnter", type: "string", required: false, description: "Action name to execute when entering this route." },
  { name: "onRouteLeave", type: "string", required: false, description: "Action name to execute when leaving this route." }
]} />

### Example

```json
{
  "lifecycle": {
    "onMount": "initEditor",
    "onUnmount": "cleanup"
  },
  "actions": [
    {
      "name": "initEditor",
      "steps": [
        { "do": "import", "module": "monaco-editor", "result": "monaco" }
      ]
    },
    {
      "name": "cleanup",
      "steps": [
        { "do": "dispose", "target": { "expr": "state", "name": "editor" } }
      ]
    }
  ]
}
```

## Route Definition

The `route` property defines routing metadata for a page. Used with `@constela/start`.

<PropsTable items={[
  { name: "path", type: "string", required: true, description: "URL path pattern (e.g., \"/docs/[slug]\")" },
  { name: "layout", type: "string", required: false, description: "Layout name to wrap this page." },
  { name: "layoutParams", type: "Record<string, Expression>", required: false, description: "Parameters to pass to the layout." },
  { name: "meta", type: "Record<string, Expression>", required: false, description: "Meta tags for the page (title, description, etc.)." }
]} />

### Example

```json
{
  "route": {
    "path": "/blog/[slug]",
    "layout": "docs",
    "meta": {
      "title": { "expr": "data", "name": "post", "path": "frontmatter.title" },
      "description": { "expr": "data", "name": "post", "path": "frontmatter.description" }
    }
  }
}
```

## Layout Files

Layout files use `"type": "layout"` and must contain at least one `slot` node for page content injection.

```json
{
  "version": "1.0",
  "type": "layout",
  "state": {
    "theme": { "type": "string", "initial": "light" }
  },
  "actions": [],
  "view": {
    "kind": "element",
    "tag": "div",
    "props": { "class": { "expr": "lit", "value": "layout" } },
    "children": [
      {
        "kind": "element",
        "tag": "header",
        "children": [{ "kind": "text", "value": { "expr": "lit", "value": "Site Header" } }]
      },
      {
        "kind": "element",
        "tag": "main",
        "children": [{ "kind": "slot" }]
      },
      {
        "kind": "element",
        "tag": "footer",
        "children": [{ "kind": "text", "value": { "expr": "lit", "value": "Site Footer" } }]
      }
    ]
  }
}
```
