---
title: Actions
description: Complete reference for action definitions and step types
---

## Overview

Actions define how your application responds to user interactions and events. Each action consists of a name and a sequence of steps that execute in order.

## Action Definition

```json
{
  "name": "incrementCounter",
  "steps": [
    { "do": "update", "target": "count", "operation": "increment" }
  ]
}
```

<PropsTable items={[
  { name: "name", type: "string", required: true, description: "Unique identifier for the action. Used in event handlers." },
  { name: "steps", type: "ActionStep[]", required: true, description: "Array of steps to execute when the action is triggered." }
]} />

## Set Step

Directly sets a state value.

```json
{
  "do": "set",
  "target": "message",
  "value": { "expr": "lit", "value": "Hello!" }
}
```

<PropsTable items={[
  { name: "do", type: "\"set\"", required: true, description: "Step type identifier." },
  { name: "target", type: "string", required: true, description: "State field to modify. Use dot notation for nested paths." },
  { name: "value", type: "Expression", required: true, description: "Expression that evaluates to the new value." }
]} />

### Examples

```json
// Set a simple value
{ "do": "set", "target": "name", "value": { "expr": "lit", "value": "John" } }

// Set from event parameter
{
  "do": "set",
  "target": "inputValue",
  "value": { "expr": "param", "name": "event", "path": "target.value" }
}

// Set nested property
{
  "do": "set",
  "target": "user.profile.name",
  "value": { "expr": "lit", "value": "Jane" }
}
```

## Update Step

Applies a predefined operation to a state value.

```json
{
  "do": "update",
  "target": "count",
  "operation": "increment"
}
```

<PropsTable items={[
  { name: "do", type: "\"update\"", required: true, description: "Step type identifier." },
  { name: "target", type: "string", required: true, description: "State field to modify." },
  { name: "operation", type: "string", required: true, description: "Operation to perform (see operations table)." },
  { name: "value", type: "Expression", required: false, description: "Value for operations that require one (e.g., push, remove)." }
]} />

### Operations

| Operation | Description | Requires Value | State Type |
|-----------|-------------|----------------|------------|
| `increment` | Adds to a number (default: 1) | No (optional value) | number |
| `decrement` | Subtracts from a number (default: 1) | No (optional value) | number |
| `toggle` | Flips a boolean value | No | boolean |
| `push` | Appends to an array | Yes | list |
| `pop` | Removes last element from array | No | list |
| `remove` | Removes matching element from array | Yes | list |
| `replaceAt` | Replaces element at a specific index | Yes (index + value) | list |
| `insertAt` | Inserts element at a specific index | Yes (index + value) | list |
| `splice` | Deletes and/or inserts at index | Yes (index + deleteCount, optional value) | list |
| `merge` | Shallow-merges properties into an object | Yes | object |

### Examples

```json
// Increment counter
{ "do": "update", "target": "count", "operation": "increment" }

// Add item to array
{
  "do": "update",
  "target": "todos",
  "operation": "push",
  "value": { "expr": "state", "name": "newTodo" }
}

// Remove item from array
{
  "do": "update",
  "target": "items",
  "operation": "remove",
  "value": { "expr": "var", "name": "itemToRemove" }
}

// Remove last item
{ "do": "update", "target": "stack", "operation": "pop" }
```

### toggle

Flips a boolean state value. Ideal for toggles, modals, and visibility controls.

```json
{ "do": "update", "target": "isOpen", "operation": "toggle" }
```

<PropsTable items={[
  { name: "do", type: "\"update\"", required: true, description: "Step type identifier." },
  { name: "target", type: "string", required: true, description: "State field to toggle (must be boolean)." },
  { name: "operation", type: "\"toggle\"", required: true, description: "Toggle operation identifier." }
]} />

<Callout type="note">
The target state must be a boolean type. Using toggle on non-boolean values results in a compile-time error.
</Callout>

### merge

Shallow-merges properties into an object state. Existing properties are preserved unless overwritten.

```json
{
  "do": "update",
  "target": "form",
  "operation": "merge",
  "value": { "expr": "lit", "value": { "email": "user@example.com" } }
}
```

<PropsTable items={[
  { name: "do", type: "\"update\"", required: true, description: "Step type identifier." },
  { name: "target", type: "string", required: true, description: "State field to merge into (must be object)." },
  { name: "operation", type: "\"merge\"", required: true, description: "Merge operation identifier." },
  { name: "value", type: "Expression", required: true, description: "Object expression to merge into target." }
]} />

#### Merge Example

```json
// State: form = { name: "John", email: "" }
{
  "do": "update",
  "target": "form",
  "operation": "merge",
  "value": { "expr": "lit", "value": { "email": "john@example.com", "phone": "123-456" } }
}
// Result: form = { name: "John", email: "john@example.com", phone: "123-456" }
```

### replaceAt

Replaces an element at a specific index in an array. Useful for editing list items in place.

```json
{
  "do": "update",
  "target": "todos",
  "operation": "replaceAt",
  "index": { "expr": "var", "name": "index" },
  "value": { "expr": "lit", "value": { "title": "Updated", "done": true } }
}
```

<PropsTable items={[
  { name: "do", type: "\"update\"", required: true, description: "Step type identifier." },
  { name: "target", type: "string", required: true, description: "State field (must be list)." },
  { name: "operation", type: "\"replaceAt\"", required: true, description: "ReplaceAt operation identifier." },
  { name: "index", type: "Expression", required: true, description: "Expression evaluating to the index to replace." },
  { name: "value", type: "Expression", required: true, description: "Expression evaluating to the new value." }
]} />

<Callout type="tip">
The `replaceAt` operation is commonly used inside `each` loops where the index is available, enabling inline editing of list items.
</Callout>

### insertAt

Inserts an element at a specific index in an array. Elements at and after the index are shifted.

```json
{
  "do": "update",
  "target": "items",
  "operation": "insertAt",
  "index": { "expr": "lit", "value": 0 },
  "value": { "expr": "state", "name": "newItem" }
}
```

<PropsTable items={[
  { name: "do", type: "\"update\"", required: true, description: "Step type identifier." },
  { name: "target", type: "string", required: true, description: "State field (must be list)." },
  { name: "operation", type: "\"insertAt\"", required: true, description: "InsertAt operation identifier." },
  { name: "index", type: "Expression", required: true, description: "Expression evaluating to the index to insert at." },
  { name: "value", type: "Expression", required: true, description: "Expression evaluating to the value to insert." }
]} />

### splice

Deletes and/or inserts items at a specific index. The most flexible list operation, mirroring JavaScript's `Array.prototype.splice()`.

```json
{
  "do": "update",
  "target": "items",
  "operation": "splice",
  "index": { "expr": "var", "name": "index" },
  "deleteCount": { "expr": "lit", "value": 1 },
  "value": { "expr": "lit", "value": ["replacement1", "replacement2"] }
}
```

<PropsTable items={[
  { name: "do", type: "\"update\"", required: true, description: "Step type identifier." },
  { name: "target", type: "string", required: true, description: "State field (must be list)." },
  { name: "operation", type: "\"splice\"", required: true, description: "Splice operation identifier." },
  { name: "index", type: "Expression", required: true, description: "Expression evaluating to the start index." },
  { name: "deleteCount", type: "Expression", required: true, description: "Expression evaluating to the number of elements to delete." },
  { name: "value", type: "Expression", required: false, description: "Expression evaluating to an array of items to insert (optional)." }
]} />

<Callout type="note">
Set `deleteCount` to 0 to insert without deleting. Omit `value` to delete without inserting.
</Callout>

## Fetch Step

Makes an HTTP request and handles the response.

```json
{
  "do": "fetch",
  "url": { "expr": "lit", "value": "https://api.example.com/data" },
  "method": "GET",
  "result": "fetchedData",
  "onSuccess": [
    { "do": "set", "target": "isLoading", "value": { "expr": "lit", "value": false } }
  ],
  "onError": [
    { "do": "set", "target": "error", "value": { "expr": "param", "name": "error" } }
  ]
}
```

<PropsTable items={[
  { name: "do", type: "\"fetch\"", required: true, description: "Step type identifier." },
  { name: "url", type: "Expression", required: true, description: "Expression that evaluates to the request URL." },
  { name: "method", type: "\"GET\" | \"POST\" | \"PUT\" | \"DELETE\"", required: false, default: "\"GET\"", description: "HTTP method." },
  { name: "body", type: "Expression", required: false, description: "Request body (for POST, PUT). Will be JSON stringified." },
  { name: "result", type: "string", required: false, description: "State field to store the response data." },
  { name: "onSuccess", type: "ActionStep[]", required: false, description: "Steps to execute on successful response." },
  { name: "onError", type: "ActionStep[]", required: false, description: "Steps to execute on error." }
]} />

### HTTP Methods

| Method | Description | Typical Use |
|--------|-------------|-------------|
| `GET` | Retrieve data | Fetching lists, details |
| `POST` | Create new resource | Submitting forms, creating items |
| `PUT` | Update existing resource | Editing items |
| `DELETE` | Remove resource | Deleting items |

### Complete Fetch Example

```json
{
  "name": "loadUsers",
  "steps": [
    {
      "do": "set",
      "target": "isLoading",
      "value": { "expr": "lit", "value": true }
    },
    {
      "do": "fetch",
      "url": { "expr": "lit", "value": "https://api.example.com/users" },
      "method": "GET",
      "result": "users",
      "onSuccess": [
        {
          "do": "set",
          "target": "isLoading",
          "value": { "expr": "lit", "value": false }
        }
      ],
      "onError": [
        {
          "do": "set",
          "target": "isLoading",
          "value": { "expr": "lit", "value": false }
        },
        {
          "do": "set",
          "target": "errorMessage",
          "value": { "expr": "lit", "value": "Failed to load users" }
        }
      ]
    }
  ]
}
```

### POST Request Example

```json
{
  "name": "createTodo",
  "steps": [
    {
      "do": "fetch",
      "url": { "expr": "lit", "value": "https://api.example.com/todos" },
      "method": "POST",
      "body": {
        "expr": "state",
        "name": "newTodo"
      },
      "onSuccess": [
        {
          "do": "update",
          "target": "todos",
          "operation": "push",
          "value": { "expr": "param", "name": "result" }
        },
        {
          "do": "set",
          "target": "newTodo",
          "value": { "expr": "lit", "value": { "title": "", "completed": false } }
        }
      ]
    }
  ]
}
```

<Callout type="tip">
In `onSuccess` handlers, the `result` parameter contains the parsed JSON response. In `onError` handlers, the `error` parameter contains error information.
</Callout>

## Combining Steps

Actions can contain multiple steps that execute sequentially:

```json
{
  "name": "submitForm",
  "steps": [
    {
      "do": "set",
      "target": "isSubmitting",
      "value": { "expr": "lit", "value": true }
    },
    {
      "do": "set",
      "target": "error",
      "value": { "expr": "lit", "value": null }
    },
    {
      "do": "fetch",
      "url": { "expr": "lit", "value": "/api/submit" },
      "method": "POST",
      "body": { "expr": "state", "name": "formData" },
      "onSuccess": [
        {
          "do": "set",
          "target": "isSubmitting",
          "value": { "expr": "lit", "value": false }
        },
        {
          "do": "set",
          "target": "submitted",
          "value": { "expr": "lit", "value": true }
        }
      ],
      "onError": [
        {
          "do": "set",
          "target": "isSubmitting",
          "value": { "expr": "lit", "value": false }
        },
        {
          "do": "set",
          "target": "error",
          "value": { "expr": "param", "name": "error" }
        }
      ]
    }
  ]
}
```

## Navigate Step

Navigates to a different URL or page.

```json
{
  "do": "navigate",
  "url": { "expr": "lit", "value": "/dashboard" }
}
```

<PropsTable items={[
  { name: "do", type: "\"navigate\"", required: true, description: "Step type identifier." },
  { name: "url", type: "Expression", required: true, description: "Expression that evaluates to the target URL." },
  { name: "target", type: "\"_self\" | \"_blank\"", required: false, default: "\"_self\"", description: "Navigation target (same tab or new tab)." },
  { name: "replace", type: "boolean", required: false, default: "false", description: "Use history.replaceState instead of pushState." }
]} />

### Examples

```json
// Navigate to a page
{ "do": "navigate", "url": { "expr": "lit", "value": "/about" } }

// Open in new tab
{
  "do": "navigate",
  "url": { "expr": "lit", "value": "https://example.com" },
  "target": "_blank"
}

// Dynamic navigation
{
  "do": "navigate",
  "url": {
    "expr": "bin",
    "op": "+",
    "left": { "expr": "lit", "value": "/posts/" },
    "right": { "expr": "var", "name": "postId" }
  }
}
```

## Storage Step

Interacts with browser localStorage or sessionStorage.

```json
{
  "do": "storage",
  "operation": "get",
  "key": { "expr": "lit", "value": "theme" },
  "storage": "local",
  "result": "savedTheme"
}
```

<PropsTable items={[
  { name: "do", type: "\"storage\"", required: true, description: "Step type identifier." },
  { name: "operation", type: "\"get\" | \"set\" | \"remove\"", required: true, description: "Storage operation to perform." },
  { name: "key", type: "Expression", required: true, description: "Expression that evaluates to the storage key." },
  { name: "storage", type: "\"local\" | \"session\"", required: true, description: "Storage type (localStorage or sessionStorage)." },
  { name: "value", type: "Expression", required: false, description: "Value to store (required for 'set' operation)." },
  { name: "result", type: "string", required: false, description: "Variable name to store the retrieved value (for 'get' operation)." },
  { name: "onSuccess", type: "ActionStep[]", required: false, description: "Steps to execute on success." },
  { name: "onError", type: "ActionStep[]", required: false, description: "Steps to execute on error." }
]} />

### Storage Operations

| Operation | Description | Requires Value | Requires Result |
|-----------|-------------|----------------|-----------------|
| `get` | Retrieve value from storage | No | Yes (recommended) |
| `set` | Store value in storage | Yes | No |
| `remove` | Remove key from storage | No | No |

### Examples

```json
// Save theme preference
{
  "do": "storage",
  "operation": "set",
  "key": { "expr": "lit", "value": "theme" },
  "value": { "expr": "state", "name": "theme" },
  "storage": "local"
}

// Load theme on mount
{
  "do": "storage",
  "operation": "get",
  "key": { "expr": "lit", "value": "theme" },
  "storage": "local",
  "result": "savedTheme",
  "onSuccess": [
    {
      "do": "if",
      "condition": { "expr": "var", "name": "savedTheme" },
      "then": [
        { "do": "set", "target": "theme", "value": { "expr": "var", "name": "savedTheme" } }
      ]
    }
  ]
}

// Clear user session
{
  "do": "storage",
  "operation": "remove",
  "key": { "expr": "lit", "value": "userToken" },
  "storage": "session"
}
```

## DOM Step

Performs direct DOM manipulation operations.

```json
{
  "do": "dom",
  "operation": "addClass",
  "selector": { "expr": "lit", "value": "html" },
  "value": { "expr": "lit", "value": "dark" }
}
```

<PropsTable items={[
  { name: "do", type: "\"dom\"", required: true, description: "Step type identifier." },
  { name: "operation", type: "string", required: true, description: "DOM operation to perform (see operations table)." },
  { name: "selector", type: "Expression", required: true, description: "CSS selector or 'html'/'body' for document elements." },
  { name: "value", type: "Expression", required: false, description: "Class name or attribute value." },
  { name: "attribute", type: "string", required: false, description: "Attribute name (for setAttribute/removeAttribute)." }
]} />

### DOM Operations

| Operation | Description | Requires Value | Requires Attribute |
|-----------|-------------|----------------|-------------------|
| `addClass` | Add a CSS class | Yes | No |
| `removeClass` | Remove a CSS class | Yes | No |
| `toggleClass` | Toggle a CSS class | Yes | No |
| `setAttribute` | Set an attribute | Yes | Yes |
| `removeAttribute` | Remove an attribute | No | Yes |

### Examples

```json
// Add dark mode class to html element
{
  "do": "dom",
  "operation": "addClass",
  "selector": { "expr": "lit", "value": "html" },
  "value": { "expr": "lit", "value": "dark" }
}

// Remove light mode class
{
  "do": "dom",
  "operation": "removeClass",
  "selector": { "expr": "lit", "value": "html" },
  "value": { "expr": "lit", "value": "light" }
}

// Set data attribute
{
  "do": "dom",
  "operation": "setAttribute",
  "selector": { "expr": "lit", "value": "body" },
  "attribute": "data-theme",
  "value": { "expr": "state", "name": "theme" }
}
```

<Callout type="note">
The `dom` step is primarily used for theme switching and other cases where you need to modify elements outside the Constela-managed view tree.
</Callout>

## Import Step

Dynamically imports an external JavaScript module at runtime.

```json
{
  "do": "import",
  "module": "monaco-editor",
  "result": "monaco",
  "onSuccess": [
    { "do": "set", "target": "editorReady", "value": { "expr": "lit", "value": true } }
  ]
}
```

<PropsTable items={[
  { name: "do", type: "\"import\"", required: true, description: "Step type identifier." },
  { name: "module", type: "string", required: true, description: "Module name (must match a key in externalImports)." },
  { name: "result", type: "string", required: true, description: "Variable name to store the imported module." },
  { name: "onSuccess", type: "ActionStep[]", required: false, description: "Steps to execute after successful import." },
  { name: "onError", type: "ActionStep[]", required: false, description: "Steps to execute on import failure." }
]} />

### Example: Loading Monaco Editor

```json
{
  "externalImports": {
    "monaco-editor": "https://cdn.jsdelivr.net/npm/monaco-editor@0.52.0/+esm"
  },
  "lifecycle": {
    "onMount": "initEditor"
  },
  "actions": [{
    "name": "initEditor",
    "steps": [{
      "do": "import",
      "module": "monaco-editor",
      "result": "monaco",
      "onSuccess": [{
        "do": "call",
        "target": { "expr": "var", "name": "monaco", "path": "editor.create" },
        "args": [
          { "expr": "ref", "name": "editorContainer" },
          { "expr": "lit", "value": { "language": "json", "theme": "vs-dark" } }
        ],
        "result": "editorInstance"
      }]
    }]
  }]
}
```

## Call Step

Calls a JavaScript function on an imported module or DOM element.

```json
{
  "do": "call",
  "target": { "expr": "var", "name": "monaco", "path": "editor.create" },
  "args": [
    { "expr": "ref", "name": "container" },
    { "expr": "lit", "value": { "language": "json" } }
  ],
  "result": "editor"
}
```

<PropsTable items={[
  { name: "do", type: "\"call\"", required: true, description: "Step type identifier." },
  { name: "target", type: "Expression", required: true, description: "Expression that evaluates to a function." },
  { name: "args", type: "Expression[]", required: false, description: "Array of argument expressions." },
  { name: "result", type: "string", required: false, description: "Variable name to store the return value." },
  { name: "onSuccess", type: "ActionStep[]", required: false, description: "Steps to execute after successful call." },
  { name: "onError", type: "ActionStep[]", required: false, description: "Steps to execute on error." }
]} />

### Examples

```json
// Call a method on an imported library
{
  "do": "call",
  "target": { "expr": "state", "name": "editor", "path": "getValue" },
  "result": "editorValue"
}

// Call with arguments
{
  "do": "call",
  "target": { "expr": "state", "name": "chart", "path": "update" },
  "args": [{ "expr": "state", "name": "chartData" }]
}
```

## Subscribe Step

Subscribes to events from an external JavaScript object.

```json
{
  "do": "subscribe",
  "target": { "expr": "state", "name": "editor" },
  "event": "onDidChangeModelContent",
  "action": "onCodeChange"
}
```

<PropsTable items={[
  { name: "do", type: "\"subscribe\"", required: true, description: "Step type identifier." },
  { name: "target", type: "Expression", required: true, description: "Expression that evaluates to an object with event methods." },
  { name: "event", type: "string", required: true, description: "Event method name to subscribe to." },
  { name: "action", type: "string", required: true, description: "Action name to execute when the event fires." }
]} />

### Example: Monaco Editor Change Events

```json
{
  "actions": [
    {
      "name": "setupEditor",
      "steps": [
        {
          "do": "subscribe",
          "target": { "expr": "state", "name": "editor" },
          "event": "onDidChangeModelContent",
          "action": "onCodeChange"
        }
      ]
    },
    {
      "name": "onCodeChange",
      "steps": [
        {
          "do": "call",
          "target": { "expr": "state", "name": "editor", "path": "getValue" },
          "result": "currentCode",
          "onSuccess": [
            { "do": "set", "target": "code", "value": { "expr": "var", "name": "currentCode" } }
          ]
        }
      ]
    }
  ]
}
```

## Dispose Step

Manually disposes of a resource (cleanup subscriptions, destroy editors, etc.).

```json
{
  "do": "dispose",
  "target": { "expr": "state", "name": "editor" }
}
```

<PropsTable items={[
  { name: "do", type: "\"dispose\"", required: true, description: "Step type identifier." },
  { name: "target", type: "Expression", required: true, description: "Expression that evaluates to an object with a dispose() method." }
]} />

### Example: Cleanup on Unmount

```json
{
  "lifecycle": {
    "onUnmount": "cleanup"
  },
  "actions": [{
    "name": "cleanup",
    "steps": [
      { "do": "dispose", "target": { "expr": "state", "name": "subscription" } },
      { "do": "dispose", "target": { "expr": "state", "name": "editor" } }
    ]
  }]
}
```

<Callout type="tip">
Always dispose of external resources in the `onUnmount` lifecycle hook to prevent memory leaks.
</Callout>

## If Step

Conditionally executes steps based on a condition.

```json
{
  "do": "if",
  "condition": { "expr": "state", "name": "isLoggedIn" },
  "then": [
    { "do": "navigate", "url": { "expr": "lit", "value": "/dashboard" } }
  ],
  "else": [
    { "do": "navigate", "url": { "expr": "lit", "value": "/login" } }
  ]
}
```

<PropsTable items={[
  { name: "do", type: "\"if\"", required: true, description: "Step type identifier." },
  { name: "condition", type: "Expression", required: true, description: "Expression that evaluates to a boolean." },
  { name: "then", type: "ActionStep[]", required: true, description: "Steps to execute when condition is true." },
  { name: "else", type: "ActionStep[]", required: false, description: "Steps to execute when condition is false." }
]} />

### Examples

```json
// Conditional theme application
{
  "do": "if",
  "condition": { "expr": "var", "name": "savedTheme" },
  "then": [
    { "do": "set", "target": "theme", "value": { "expr": "var", "name": "savedTheme" } },
    {
      "do": "dom",
      "operation": "addClass",
      "selector": { "expr": "lit", "value": "html" },
      "value": { "expr": "var", "name": "savedTheme" }
    }
  ]
}

// Validation before submit
{
  "do": "if",
  "condition": {
    "expr": "bin",
    "op": "!=",
    "left": { "expr": "state", "name": "email" },
    "right": { "expr": "lit", "value": "" }
  },
  "then": [
    { "do": "fetch", "url": { "expr": "lit", "value": "/api/submit" }, "method": "POST" }
  ],
  "else": [
    { "do": "set", "target": "error", "value": { "expr": "lit", "value": "Email is required" } }
  ]
}
```

## SetPath Step

Updates a value at a specific path within a nested object or array. Unlike `set` which replaces the entire target, `setPath` allows surgical updates to deeply nested state.

```json
{
  "do": "setPath",
  "target": "todos",
  "path": { "expr": "lit", "value": [0, "completed"] },
  "value": { "expr": "lit", "value": true }
}
```

<PropsTable items={[
  { name: "do", type: "\"setPath\"", required: true, description: "Step type identifier." },
  { name: "target", type: "string", required: true, description: "State field containing the array or object." },
  { name: "path", type: "Expression", required: true, description: "Expression that evaluates to a path. Can be a string (dot notation like \"address.city\"), an array of keys/indices, or an array containing expressions for dynamic segments." },
  { name: "value", type: "Expression", required: true, description: "New value to set at the path." }
]} />

### Why Use setPath?

The `setPath` step solves a common problem: updating a single field in an array item without replacing the entire item. This is more efficient and preserves other fields.

| Approach | Code | Result |
|----------|------|--------|
| `replaceAt` | Replaces entire item | Loses other fields unless you rebuild the object |
| `setPath` | Updates single field | Preserves all other fields automatically |

### Examples

```json
// Toggle completion status of a todo item (dynamic index from payload)
{
  "do": "setPath",
  "target": "todos",
  "path": { "expr": "lit", "value": [{ "expr": "var", "name": "index" }, "completed"] },
  "value": {
    "expr": "not",
    "operand": { "expr": "var", "name": "todo", "path": "completed" }
  }
}

// Update username in a nested user object (literal index)
{
  "do": "setPath",
  "target": "users",
  "path": { "expr": "lit", "value": [0, "profile", "name"] },
  "value": { "expr": "state", "name": "newName" }
}

// Update using dot notation string path
{
  "do": "setPath",
  "target": "config",
  "path": { "expr": "lit", "value": "settings.display.theme" },
  "value": { "expr": "lit", "value": "dark" }
}

// Update score for a specific player (dynamic index)
{
  "do": "setPath",
  "target": "players",
  "path": { "expr": "lit", "value": [{ "expr": "var", "name": "playerId" }, "score"] },
  "value": {
    "expr": "bin",
    "op": "+",
    "left": { "expr": "var", "name": "player", "path": "score" },
    "right": { "expr": "lit", "value": 10 }
  }
}
```

<Callout type="tip">
Use `setPath` inside `each` loops where you have access to both the item and its index, enabling inline editing without complex state reconstruction.
</Callout>

## Send Step

Sends a message through a WebSocket connection. See [Connections](/reference/connections) for full WebSocket documentation.

```json
{
  "do": "send",
  "connection": "chat",
  "data": { "expr": "state", "name": "messageInput" }
}
```

<PropsTable items={[
  { name: "do", type: "\"send\"", required: true, description: "Step type identifier." },
  { name: "connection", type: "string", required: true, description: "Name of the connection to send through (must match a key in connections)." },
  { name: "data", type: "Expression", required: true, description: "Data to send. Objects are automatically JSON stringified." }
]} />

### Example

```json
{
  "name": "sendChatMessage",
  "steps": [
    {
      "do": "send",
      "connection": "chat",
      "data": {
        "expr": "obj",
        "properties": {
          "type": { "expr": "lit", "value": "message" },
          "text": { "expr": "state", "name": "messageInput" },
          "user": { "expr": "state", "name": "username" }
        }
      }
    },
    {
      "do": "set",
      "target": "messageInput",
      "value": { "expr": "lit", "value": "" }
    }
  ]
}
```

## Close Step

Closes a WebSocket connection. See [Connections](/reference/connections) for full WebSocket documentation.

```json
{
  "do": "close",
  "connection": "chat"
}
```

<PropsTable items={[
  { name: "do", type: "\"close\"", required: true, description: "Step type identifier." },
  { name: "connection", type: "string", required: true, description: "Name of the connection to close." },
  { name: "code", type: "Expression", required: false, default: "1000", description: "WebSocket close status code." },
  { name: "reason", type: "Expression", required: false, description: "Human-readable close reason." }
]} />

### Example

```json
{
  "name": "disconnectChat",
  "steps": [
    {
      "do": "close",
      "connection": "chat",
      "code": { "expr": "lit", "value": 1000 },
      "reason": { "expr": "lit", "value": "User logged out" }
    },
    {
      "do": "set",
      "target": "isConnected",
      "value": { "expr": "lit", "value": false }
    }
  ]
}
```
