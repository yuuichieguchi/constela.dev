---
title: Routing
description: Add client-side routing
---

<Callout type="note">
Routing is provided by `@constela/router`, a separate package. It is not part of the core DSL.
</Callout>

## Installation

Install the router package:

```bash
npm install @constela/router
```

## Creating a Router

Use `createRouter` to set up client-side navigation:

```javascript
import { createApp } from '@constela/runtime';
import { createRouter } from '@constela/router';

const router = createRouter({
  routes: [
    { path: '/', component: 'HomePage' },
    { path: '/about', component: 'AboutPage' },
    { path: '/users/:id', component: 'UserPage' }
  ]
});

const app = createApp(definition, { router });
app.mount(document.getElementById('root'));
```

## Route Definition

Each route has:

| Field | Required | Description |
|-------|----------|-------------|
| `path` | Yes | URL path pattern |
| `component` | Yes | Component name to render |
| `exact` | No | Match path exactly (default: true) |

```javascript
const routes = [
  { path: '/', component: 'HomePage', exact: true },
  { path: '/products', component: 'ProductList' },
  { path: '/products/:id', component: 'ProductDetail' },
  { path: '/products/:id/reviews', component: 'ProductReviews' },
  { path: '*', component: 'NotFound' }
];
```

### Path Parameters

Use `:paramName` syntax for dynamic segments:

```javascript
{ path: '/users/:userId', component: 'UserPage' }
{ path: '/posts/:year/:month/:slug', component: 'BlogPost' }
```

### Wildcard Routes

Use `*` to catch all unmatched routes:

```javascript
{ path: '*', component: 'NotFoundPage' }
```

<Callout type="tip">
Always place the wildcard route last in your routes array.
</Callout>

## Navigation

### Link Component

Use the built-in `Link` component for navigation:

```json
{
  "kind": "component",
  "name": "Link",
  "props": {
    "to": { "expr": "lit", "value": "/about" }
  },
  "children": [
    { "kind": "text", "value": { "expr": "lit", "value": "About Us" } }
  ]
}
```

### Programmatic Navigation

Navigate programmatically using the router action:

```json
{
  "actions": [
    {
      "name": "goToUser",
      "steps": [
        {
          "do": "navigate",
          "url": { "expr": "lit", "value": "/users/123" }
        }
      ]
    }
  ]
}
```

With dynamic paths:

```json
{
  "actions": [
    {
      "name": "viewUserProfile",
      "steps": [
        {
          "do": "navigate",
          "url": {
            "expr": "bin",
            "op": "+",
            "left": { "expr": "lit", "value": "/users/" },
            "right": { "expr": "state", "name": "selectedUserId" }
          }
        }
      ]
    }
  ]
}
```

## Accessing Route Parameters

Access route parameters using the `route` expression:

```json
{
  "kind": "text",
  "value": { "expr": "route", "name": "id" }
}
```

### Route Expression Sources

The `route` expression supports different sources for accessing URL data:

| Source | Description | Example |
|--------|-------------|---------|
| `param` (default) | Dynamic path segments | `/users/:id` → `{ "expr": "route", "name": "id" }` |
| `query` | URL query parameters | `?search=test` → `{ "expr": "route", "name": "search", "source": "query" }` |
| `path` | Full current path | `{ "expr": "route", "source": "path" }` |

### Query Parameters

Access query string values with `source: "query"`:

```json
{
  "kind": "text",
  "value": { "expr": "route", "name": "search", "source": "query" }
}
```

For a URL like `/products?category=electronics&page=2`:

```json
{
  "kind": "element",
  "tag": "div",
  "children": [
    {
      "kind": "text",
      "value": { "expr": "route", "name": "category", "source": "query" }
    }
  ]
}
```

### Current Path

Access the full current path:

```json
{
  "kind": "text",
  "value": { "expr": "route", "source": "path" }
}
```

### Example: User Profile Page

```json
{
  "components": {
    "UserPage": {
      "view": {
        "kind": "element",
        "tag": "div",
        "children": [
          {
            "kind": "element",
            "tag": "h1",
            "children": [
              { "kind": "text", "value": { "expr": "lit", "value": "User Profile" } }
            ]
          },
          {
            "kind": "element",
            "tag": "p",
            "children": [
              { "kind": "text", "value": { "expr": "lit", "value": "User ID: " } },
              { "kind": "text", "value": { "expr": "route", "name": "id" } }
            ]
          }
        ]
      }
    }
  }
}
```

## Router Outlet

Use `RouterOutlet` to specify where route components render:

```json
{
  "view": {
    "kind": "element",
    "tag": "div",
    "children": [
      {
        "kind": "element",
        "tag": "nav",
        "children": [
          {
            "kind": "component",
            "name": "Link",
            "props": { "to": { "expr": "lit", "value": "/" } },
            "children": [
              { "kind": "text", "value": { "expr": "lit", "value": "Home" } }
            ]
          },
          {
            "kind": "component",
            "name": "Link",
            "props": { "to": { "expr": "lit", "value": "/about" } },
            "children": [
              { "kind": "text", "value": { "expr": "lit", "value": "About" } }
            ]
          }
        ]
      },
      {
        "kind": "component",
        "name": "RouterOutlet"
      }
    ]
  }
}
```

## Complete Example: Multi-Page App

```javascript
// main.js
import { createApp } from '@constela/runtime';
import { createRouter } from '@constela/router';
import definition from './app.json';

const router = createRouter({
  routes: [
    { path: '/', component: 'HomePage' },
    { path: '/products', component: 'ProductList' },
    { path: '/products/:id', component: 'ProductDetail' },
    { path: '/cart', component: 'CartPage' },
    { path: '*', component: 'NotFound' }
  ]
});

const app = createApp(definition, { router });
app.mount(document.getElementById('root'));
```

```json
{
  "version": "1.0",
  "components": {
    "HomePage": {
      "view": {
        "kind": "element",
        "tag": "div",
        "children": [
          {
            "kind": "element",
            "tag": "h1",
            "children": [
              { "kind": "text", "value": { "expr": "lit", "value": "Welcome" } }
            ]
          },
          {
            "kind": "component",
            "name": "Link",
            "props": { "to": { "expr": "lit", "value": "/products" } },
            "children": [
              { "kind": "text", "value": { "expr": "lit", "value": "Browse Products" } }
            ]
          }
        ]
      }
    },
    "ProductList": {
      "view": {
        "kind": "element",
        "tag": "div",
        "children": [
          {
            "kind": "element",
            "tag": "h1",
            "children": [
              { "kind": "text", "value": { "expr": "lit", "value": "Products" } }
            ]
          },
          {
            "kind": "each",
            "items": { "expr": "state", "name": "products" },
            "as": "product",
            "body": {
              "kind": "component",
              "name": "Link",
              "props": {
                "to": {
                  "expr": "bin",
                  "op": "+",
                  "left": { "expr": "lit", "value": "/products/" },
                  "right": { "expr": "var", "name": "product", "path": "id" }
                }
              },
              "children": [
                { "kind": "text", "value": { "expr": "var", "name": "product", "path": "name" } }
              ]
            }
          }
        ]
      }
    },
    "ProductDetail": {
      "view": {
        "kind": "element",
        "tag": "div",
        "children": [
          {
            "kind": "element",
            "tag": "h1",
            "children": [
              { "kind": "text", "value": { "expr": "lit", "value": "Product Detail" } }
            ]
          },
          {
            "kind": "element",
            "tag": "p",
            "children": [
              { "kind": "text", "value": { "expr": "lit", "value": "Product ID: " } },
              { "kind": "text", "value": { "expr": "route", "name": "id" } }
            ]
          },
          {
            "kind": "component",
            "name": "Link",
            "props": { "to": { "expr": "lit", "value": "/products" } },
            "children": [
              { "kind": "text", "value": { "expr": "lit", "value": "Back to Products" } }
            ]
          }
        ]
      }
    },
    "NotFound": {
      "view": {
        "kind": "element",
        "tag": "div",
        "children": [
          {
            "kind": "element",
            "tag": "h1",
            "children": [
              { "kind": "text", "value": { "expr": "lit", "value": "404 - Page Not Found" } }
            ]
          },
          {
            "kind": "component",
            "name": "Link",
            "props": { "to": { "expr": "lit", "value": "/" } },
            "children": [
              { "kind": "text", "value": { "expr": "lit", "value": "Go Home" } }
            ]
          }
        ]
      }
    }
  },
  "state": {
    "products": {
      "type": "list",
      "initial": [
        { "id": "1", "name": "Product A" },
        { "id": "2", "name": "Product B" },
        { "id": "3", "name": "Product C" }
      ]
    }
  },
  "view": {
    "kind": "element",
    "tag": "div",
    "children": [
      {
        "kind": "element",
        "tag": "header",
        "children": [
          {
            "kind": "component",
            "name": "Link",
            "props": { "to": { "expr": "lit", "value": "/" } },
            "children": [
              { "kind": "text", "value": { "expr": "lit", "value": "Home" } }
            ]
          },
          {
            "kind": "component",
            "name": "Link",
            "props": { "to": { "expr": "lit", "value": "/products" } },
            "children": [
              { "kind": "text", "value": { "expr": "lit", "value": "Products" } }
            ]
          },
          {
            "kind": "component",
            "name": "Link",
            "props": { "to": { "expr": "lit", "value": "/cart" } },
            "children": [
              { "kind": "text", "value": { "expr": "lit", "value": "Cart" } }
            ]
          }
        ]
      },
      {
        "kind": "element",
        "tag": "main",
        "children": [
          {
            "kind": "component",
            "name": "RouterOutlet"
          }
        ]
      }
    ]
  }
}
```

## Route Lifecycle Hooks

Execute actions when entering or leaving routes using lifecycle hooks:

```json
{
  "lifecycle": {
    "onRouteEnter": "loadPageData",
    "onRouteLeave": "saveProgress"
  }
}
```

### Available Route Hooks

| Hook | Description |
|------|-------------|
| `onRouteEnter` | Executed when navigating to this route |
| `onRouteLeave` | Executed when navigating away from this route |

### Example: Load Data on Route Enter

```json
{
  "lifecycle": {
    "onRouteEnter": "loadUserData"
  },
  "actions": [
    {
      "name": "loadUserData",
      "steps": [
        {
          "do": "set",
          "target": "loading",
          "value": { "expr": "lit", "value": true }
        },
        {
          "do": "fetch",
          "url": {
            "expr": "bin",
            "op": "+",
            "left": { "expr": "lit", "value": "/api/users/" },
            "right": { "expr": "route", "name": "id" }
          },
          "result": "user",
          "onSuccess": [
            {
              "do": "set",
              "target": "loading",
              "value": { "expr": "lit", "value": false }
            }
          ]
        }
      ]
    }
  ]
}
```

<Callout type="tip">
Use `onRouteEnter` to fetch data specific to the route. Use `onRouteLeave` to save unsaved changes or clean up resources before navigating away.
</Callout>

## Summary

The `@constela/router` package provides:

- **Declarative routing**: Define routes as a simple array
- **Dynamic parameters**: Use `:param` syntax for URL parameters
- **Link component**: Navigate without page reloads
- **Programmatic navigation**: Navigate from actions
- **RouterOutlet**: Control where content renders

This keeps routing concerns separate from the core DSL while providing a seamless integration experience.
